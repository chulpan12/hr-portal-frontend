<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>텍스트 분석 및 인사이트 도구</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- WordCloud2.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.js"></script>
    <!-- Google Fonts for Korean -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --input-bg: #374151;
            --input-border: #4b5563;
        }
        html.light {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --input-bg: #f3f4f6;
            --input-border: #d1d5db;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .control-panel label { font-weight: 600; }
        .control-panel textarea, .control-panel input {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-primary);
        }
        .control-panel textarea:focus, .control-panel input:focus {
            --tw-ring-color: #2dd4bf;
        }
        .placeholder-custom::placeholder { color: var(--text-secondary); }
        .result-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--input-border);
        }
        .loader {
            border-top-color: #2dd4bf;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <div id="main-content" class="hidden">
            <header class="text-center mb-10 relative">
                <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-500">
                    텍스트 분석 및 인사이트
                </h1>
                <p class="text-lg mt-3" style="color: var(--text-secondary);">긴 글의 핵심을 빠르게 파악하고 숨겨진 의미를 발견하세요.(Google AI모델을 사용합니다)</p>
                
                <div class="absolute top-0 right-0">
                    <button id="themeToggle" class="p-2 rounded-full transition" style="background-color: var(--input-bg);">
                        <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"></svg>
                    </button>
                </div>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 왼쪽: 컨트롤 패널 -->
                <div class="lg:col-span-1 backdrop-blur-sm border p-6 rounded-2xl shadow-lg control-panel flex flex-col" style="background-color: var(--bg-panel); border-color: var(--border-color);">
                    <div class="flex-grow flex flex-col">
                        <label for="textInput" class="text-sm mb-2" style="color: var(--text-secondary);">분석할 텍스트를 여기에 붙여넣으세요</label>
                        <textarea id="textInput" class="w-full flex-grow p-4 rounded-lg placeholder-custom focus:ring-2 focus:border-transparent text-sm leading-relaxed"></textarea>
                    </div>
                    <button id="analyzeBtn" class="w-full mt-6 flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        <span>분석하기</span>
                    </button>
                </div>

                <!-- 오른쪽: 분석 결과 -->
                <div id="resultWrapper" class="lg:col-span-1 space-y-6 lg:min-h-[700px]">
                    <div id="loader" class="hidden h-full w-full flex justify-center items-center">
                        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                    </div>
                    
                    <div id="resultCards" class="hidden space-y-6">
                        <div class="result-card p-5 rounded-xl">
                            <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                핵심 요약
                            </h3>
                            <p id="summary" class="text-sm leading-relaxed" style="color: var(--text-secondary);"></p>
                        </div>
                        
                        <div class="result-card p-5 rounded-xl">
                            <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11" /></svg>
                                워드 클라우드
                            </h3>
                            <div class="flex justify-center items-center">
                                <canvas id="wordCloudCanvas" width="400" height="250"></canvas>
                            </div>
                        </div>

                        <div class="result-card p-5 rounded-xl">
                            <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-5 5a2 2 0 01-2.828 0l-7-7A2 2 0 013 8v5z" /></svg>
                                핵심 키워드
                            </h3>
                            <div id="keywords" class="flex flex-wrap gap-2"></div>
                        </div>
                        <div class="result-card p-5 rounded-xl">
                            <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                감성 분석
                            </h3>
                            <div class="space-y-2">
                                <div class="w-full bg-gray-700 rounded-full h-2.5">
                                    <div id="sentiment-bar" class="h-2.5 rounded-full" style="width: 0%;"></div>
                                </div>
                                <p id="sentiment-text" class="text-sm text-center" style="color: var(--text-secondary);"></p>
                            </div>
                        </div>
                        <div class="result-card p-5 rounded-xl">
                            <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                                텍스트 통계
                            </h3>
                            <div id="stats" class="grid grid-cols-2 gap-4 text-center text-sm"></div>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="text-center py-8 text-xs" style="color: var(--text-secondary);">
                <p>Copyright &copy; Seyoong Jang, <a href="https://dreamofenc.com" target="_blank" class="hover:underline text-indigo-400">https://dreamofenc.com</a> All right reserved.</p>
                <p class="mt-1">문의/건의사항 : 노무후생그룹 장세융 차장</p>
            </footer>
        </div>

        <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-sm">
                <h2 class="text-2xl font-bold text-white text-center mb-6">AI 기능 로그인</h2>
                <p class="text-center text-sm text-gray-400 mb-6">이 기능을 사용하려면 DokuWiki 계정으로 로그인해야 합니다.</p>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="username" class="block text-gray-400 text-sm font-bold mb-2">아이디</label>
                        <input type="text" id="username" class="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-gray-400 text-sm font-bold mb-2">비밀번호</label>
                        <input type="password" id="password" class="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                    </div>
                    <div class="flex items-center justify-center">
                        <button type="submit" id="login-submit-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full">
                            로그인
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- Setup ---
        const dom = {
            mainContent: document.getElementById('main-content'),
            loginModal: document.getElementById('login-modal'),
            loginForm: document.getElementById('login-form'),
            loginSubmitBtn: document.getElementById('login-submit-btn'),
            textInput: document.getElementById('textInput'),
            analyzeBtn: document.getElementById('analyzeBtn'),
            resultWrapper: document.getElementById('resultWrapper'),
            loader: document.getElementById('loader'),
            resultCards: document.getElementById('resultCards'),
            summary: document.getElementById('summary'),
            keywords: document.getElementById('keywords'),
            wordCloudCanvas: document.getElementById('wordCloudCanvas'),
            sentimentBar: document.getElementById('sentiment-bar'),
            sentimentText: document.getElementById('sentiment-text'),
            stats: document.getElementById('stats'),
            themeToggle: document.getElementById('themeToggle'),
            themeIcon: document.getElementById('themeIcon'),
        };

        // --- Event Listeners ---
        dom.analyzeBtn.addEventListener('click', analyzeText);
        dom.themeToggle.addEventListener('click', toggleTheme);
        dom.loginForm.addEventListener('submit', handleLogin);

        // --- Core Functions ---
        document.addEventListener('DOMContentLoaded', () => {
            const token = sessionStorage.getItem('ai-tool-token');
            if (token) {
                dom.mainContent.classList.remove('hidden');
                dom.loginModal.classList.add('hidden');
            } else {
                dom.mainContent.classList.add('hidden');
                dom.loginModal.classList.remove('hidden');
            }
            updateThemeIcon();
        });

        async function handleLogin(e) {
            e.preventDefault();
            const username = dom.loginForm.username.value;
            const password = dom.loginForm.password.value;
            
            dom.loginSubmitBtn.disabled = true;
            dom.loginSubmitBtn.textContent = '로그인 중...';

            const apiUrl = 'https://api.dreamofenc.com/api/auth/login';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '로그인에 실패했습니다.');
                }

                const data = await response.json();
                sessionStorage.setItem('ai-tool-token', data.token);
                
                dom.loginModal.classList.add('hidden');
                dom.mainContent.classList.remove('hidden');
                dom.loginForm.reset();

            } catch (error) {
                alert(error.message);
            } finally {
                dom.loginSubmitBtn.disabled = false;
                dom.loginSubmitBtn.textContent = '로그인';
            }
        }

        async function analyzeText() {
            const textToAnalyze = dom.textInput.value;
            if (textToAnalyze.trim() === '') {
                alert('분석할 텍스트를 입력해주세요.');
                return;
            }

            dom.loader.classList.remove('hidden');
            dom.resultCards.classList.add('hidden');
            
            try {
                const result = await callBackendAPI(textToAnalyze);
                renderResults(result);
            } catch (error) {
                console.error("API 호출 오류:", error);
                alert(`분석 중 오류가 발생했습니다: ${error.message}`);
            } finally {
                dom.loader.classList.add('hidden');
                dom.resultCards.classList.remove('hidden');
            }
        }

        async function callBackendAPI(text) {
            const apiUrl = 'https://api.dreamofenc.com/api/analyzer/analyze';
            const token = sessionStorage.getItem('ai-tool-token');

            if (!token) {
                dom.mainContent.classList.add('hidden');
                dom.loginModal.classList.remove('hidden');
                throw new Error('세션이 만료되었습니다. 다시 로그인해주세요.');
            }

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ text: text })
            });

            if (response.status === 401) {
                 sessionStorage.removeItem('ai-tool-token');
                 dom.mainContent.classList.add('hidden');
                 dom.loginModal.classList.remove('hidden');
                 throw new Error('인증에 실패했습니다. 다시 로그인해주세요.');
            }

            if (!response.ok) {
                try {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `서버 응답 오류: ${response.status}`);
                } catch (e) {
                    throw new Error(`서버 응답 오류: ${response.status}`);
                }
            }

            return await response.json();
        }

        function renderResults(data) {
            const isLight = document.documentElement.classList.contains('light');

            dom.summary.textContent = data.summary;

            dom.keywords.innerHTML = '';
            data.keywords.slice(0, 5).forEach(kw => {
                const tag = document.createElement('span');
                tag.className = 'bg-teal-500/20 text-teal-300 text-xs font-medium px-2.5 py-1 rounded-full';
                tag.textContent = `#${kw.keyword} (${kw.frequency})`;
                dom.keywords.appendChild(tag);
            });

            const wordList = data.keywords.map(kw => [kw.keyword, kw.frequency * 5]);
            if (wordList.length > 0) {
                WordCloud(dom.wordCloudCanvas, {
                    list: wordList,
                    gridSize: 8,
                    weightFactor: 6,
                    fontFamily: "'Noto Sans KR', sans-serif",
                    color: isLight ? '#4b5563' : '#9ca3af',
                    backgroundColor: 'transparent',
                    rotateRatio: 0.3,
                    minRotation: -Math.PI / 6,
                    maxRotation: Math.PI / 6,
                });
            }

            const score = data.sentiment.score;
            const percentage = (score - 1) * (100 / 9);
            dom.sentimentBar.style.width = `${percentage}%`;
            
            let colorClass = 'bg-yellow-400';
            if (score > 7) colorClass = 'bg-green-400';
            if (score < 4) colorClass = 'bg-red-400';
            dom.sentimentBar.className = `h-2.5 rounded-full ${colorClass}`;
            dom.sentimentText.textContent = `${data.sentiment.reason} (점수: ${score}/10)`;

            dom.stats.innerHTML = `
                <div>
                    <div class="font-bold text-xl">${new Intl.NumberFormat().format(data.stats.charCount)}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">글자 수</div>
                </div>
                <div>
                    <div class="font-bold text-xl">${new Intl.NumberFormat().format(data.stats.wordCount)}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">단어 수</div>
                </div>
                <div class="col-span-2 mt-2">
                    <div class="font-bold text-xl">${data.stats.readability}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">예상 가독성</div>
                </div>
            `;
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isLight = document.documentElement.classList.contains('light');
            dom.themeIcon.innerHTML = isLight 
                ? `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`
                : `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`;
        }

        // --- Initial Load ---
        dom.textInput.value = `[기사] AI 기술이 비즈니스 환경에 미치는 영향\n\n최근 인공지능(AI) 기술은 전 산업에 걸쳐 혁신적인 변화를 주도하고 있다. 특히 생성형 AI의 등장은 기업의 생산성 향상에 크게 기여하며 긍정적인 평가를 받고 있다. 많은 전문가들은 AI 도입이 단순한 비용 절감을 넘어, 새로운 비즈니스 모델 창출과 고객 경험 개선의 핵심 동력이 될 것이라고 전망한다. 하지만 일각에서는 AI로 인한 일자리 감소와 데이터 편향성 문제에 대한 우려도 제기되고 있어, 기술 도입과 함께 사회적, 윤리적 논의가 반드시 병행되어야 한다는 목소리가 높다. 기업들은 이러한 변화에 능동적으로 대응하고, AI 기술을 책임감 있게 활용하는 전략을 수립해야 할 것이다.`;
        updateThemeIcon();
    </script>
</body>
</html>
