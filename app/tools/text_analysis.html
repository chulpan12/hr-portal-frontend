<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ìŠ¤íŠ¸ ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ë„êµ¬</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- WordCloud2.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.js"></script>
    <!-- Google Fonts for Korean -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --input-bg: #374151;
            --input-border: #4b5563;
        }
        html.light {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --input-bg: #f3f4f6;
            --input-border: #d1d5db;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .control-panel label { font-weight: 600; }
        .control-panel textarea {
            background-color: var(--input-bg);
            border-color: var(--input-border);
            color: var(--text-primary);
        }
        .control-panel textarea:focus {
            --tw-ring-color: #2dd4bf;
        }
        .placeholder-custom::placeholder { color: var(--text-secondary); }
        .result-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--input-border);
        }
        .loader {
            border-top-color: #2dd4bf;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10 relative">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-500">
                í…ìŠ¤íŠ¸ ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸
            </h1>
            <p class="text-lg mt-3" style="color: var(--text-secondary);">ê¸´ ê¸€ì˜ í•µì‹¬ì„ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê³  ìˆ¨ê²¨ì§„ ì˜ë¯¸ë¥¼ ë°œê²¬í•˜ì„¸ìš”.(Google AIëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤)</p>
            
            <!-- Theme Toggle -->
            <div class="absolute top-0 right-0">
                <button id="themeToggle" class="p-2 rounded-full transition" style="background-color: var(--input-bg);">
                    <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"></svg>
                </button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- ì™¼ìª½: ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="lg:col-span-1 backdrop-blur-sm border p-6 rounded-2xl shadow-lg control-panel flex flex-col" style="background-color: var(--bg-panel); border-color: var(--border-color);">
                <div class="flex-grow flex flex-col">
                    <label for="textInput" class="text-sm mb-2" style="color: var(--text-secondary);">ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</label>
                    <textarea id="textInput" class="w-full flex-grow p-4 rounded-lg placeholder-custom focus:ring-2 focus:border-transparent text-sm leading-relaxed"></textarea>
                </div>
                <button id="analyzeBtn" class="w-full mt-6 flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                    <span>ë¶„ì„í•˜ê¸°</span>
                </button>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ë¶„ì„ ê²°ê³¼ -->
            <div id="resultWrapper" class="lg:col-span-1 space-y-6 lg:min-h-[700px]">
                <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
                <div id="loader" class="hidden h-full w-full flex justify-center items-center">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
                </div>
                
                <!-- ê²°ê³¼ ì¹´ë“œë“¤ -->
                <div id="resultCards" class="hidden space-y-6">
                    <!-- í•µì‹¬ ìš”ì•½ -->
                    <div class="result-card p-5 rounded-xl">
                        <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                            í•µì‹¬ ìš”ì•½
                        </h3>
                        <p id="summary" class="text-sm leading-relaxed" style="color: var(--text-secondary);"></p>
                    </div>
                    
                    <!-- âœ¨ [ì¶”ê°€] ì›Œë“œ í´ë¼ìš°ë“œ -->
                    <div class="result-card p-5 rounded-xl">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11" /></svg>
                            ì›Œë“œ í´ë¼ìš°ë“œ
                        </h3>
                        <div class="flex justify-center items-center">
                            <canvas id="wordCloudCanvas" width="400" height="250"></canvas>
                        </div>
                    </div>

                    <!-- í•µì‹¬ í‚¤ì›Œë“œ -->
                    <div class="result-card p-5 rounded-xl">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-5 5a2 2 0 01-2.828 0l-7-7A2 2 0 013 8v5z" /></svg>
                            í•µì‹¬ í‚¤ì›Œë“œ
                        </h3>
                        <div id="keywords" class="flex flex-wrap gap-2"></div>
                    </div>
                    <!-- ê°ì„± ë¶„ì„ -->
                    <div class="result-card p-5 rounded-xl">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            ê°ì„± ë¶„ì„
                        </h3>
                        <div class="space-y-2">
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="sentiment-bar" class="h-2.5 rounded-full" style="width: 0%;"></div>
                            </div>
                            <p id="sentiment-text" class="text-sm text-center" style="color: var(--text-secondary);"></p>
                        </div>
                    </div>
                    <!-- í…ìŠ¤íŠ¸ í†µê³„ -->
                    <div class="result-card p-5 rounded-xl">
                        <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                            í…ìŠ¤íŠ¸ í†µê³„
                        </h3>
                        <div id="stats" class="grid grid-cols-2 gap-4 text-center text-sm"></div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="text-center py-8 text-xs" style="color: var(--text-secondary);">
            <p>Copyright &copy; Seyoong Jang, <a href="https://dreamofenc.com" target="_blank" class="hover:underline text-indigo-400">https://dreamofenc.com</a> All right reserved.</p>
            <p class="mt-1">ë¬¸ì˜/ê±´ì˜ì‚¬í•­ : ë…¸ë¬´í›„ìƒê·¸ë£¹ ì¥ì„¸ìœµ ì°¨ì¥</p>
        </footer>
    </div>

    <script>
        // --- Setup ---
        const dom = {
            textInput: document.getElementById('textInput'),
            analyzeBtn: document.getElementById('analyzeBtn'),
            resultWrapper: document.getElementById('resultWrapper'),
            loader: document.getElementById('loader'),
            resultCards: document.getElementById('resultCards'),
            summary: document.getElementById('summary'),
            keywords: document.getElementById('keywords'),
            wordCloudCanvas: document.getElementById('wordCloudCanvas'),
            sentimentBar: document.getElementById('sentiment-bar'),
            sentimentText: document.getElementById('sentiment-text'),
            stats: document.getElementById('stats'),
            themeToggle: document.getElementById('themeToggle'),
            themeIcon: document.getElementById('themeIcon'),
        };

        // --- Event Listeners ---
        dom.analyzeBtn.addEventListener('click', analyzeText);
        dom.themeToggle.addEventListener('click', toggleTheme);

        // --- Core Functions ---
        async function analyzeText() {
            const textToAnalyze = dom.textInput.value;
            if (textToAnalyze.trim() === '') {
                alert('ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            dom.loader.classList.remove('hidden');
            dom.resultCards.classList.add('hidden');

            const prompt = `
                ì£¼ì–´ì§„ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒ í•­ëª©ë“¤ì„ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì¤˜:
                1.  summary: í…ìŠ¤íŠ¸ì˜ í•µì‹¬ ë‚´ìš©ì„ í•œêµ­ì–´ë¡œ 3ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½.
                2.  keywords: ê°€ì¥ ì¤‘ìš”í•œ í‚¤ì›Œë“œ 10~15ê°œë¥¼ { "keyword": "ë‹¨ì–´", "frequency": ë¹ˆë„ìˆ˜ } í˜•íƒœì˜ ê°ì²´ ë°°ì—´ë¡œ ì¶”ì¶œ.
                3.  sentiment: í…ìŠ¤íŠ¸ì˜ ì „ì²´ì ì¸ ê°ì„±ì„ ë¶„ì„í•˜ì—¬ { "score": 1~10 ì‚¬ì´ì˜ ì ìˆ˜, "reason": "ì ìˆ˜ì— ëŒ€í•œ í•œ ì¤„ ìš”ì•½ ì´ìœ " } í˜•íƒœë¡œ ë°˜í™˜. (1=ë§¤ìš° ë¶€ì •, 5=ì¤‘ë¦½, 10=ë§¤ìš° ê¸ì •)
                4.  stats: í…ìŠ¤íŠ¸ì˜ í†µê³„ë¥¼ { "charCount": ê¸€ì ìˆ˜(ê³µë°± í¬í•¨), "wordCount": ë‹¨ì–´ ìˆ˜, "readability": "ì½ê¸° ì‰¬ìš´ ì •ë„ (ë§¤ìš° ì‰¬ì›€, ì‰¬ì›€, ë³´í†µ, ì–´ë ¤ì›€, ë§¤ìš° ì–´ë ¤ì›€ ì¤‘ í•˜ë‚˜)" } í˜•íƒœë¡œ ê³„ì‚°.

                ë¶„ì„í•  í…ìŠ¤íŠ¸:
                ---
                ${textToAnalyze}
                ---
            `;
            
            try {
                // âœ¨ [ìˆ˜ì •] Gemini API ì§ì ‘ í˜¸ì¶œ ëŒ€ì‹ , ìš°ë¦¬ ë°±ì—”ë“œ ì„œë²„ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                const result = await callBackendAPI(textToAnalyze);
                renderResults(result);
            } catch (error) {
                console.error("API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                alert("ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } finally {
                dom.loader.classList.add('hidden');
                dom.resultCards.classList.remove('hidden');
            }
        }

        // âœ¨ [ìˆ˜ì •] ë°±ì—”ë“œ API í˜¸ì¶œ í•¨ìˆ˜
        async function callBackendAPI(text) {
            // ğŸš¨ ì£¼ì˜: ì´ ì£¼ì†ŒëŠ” ì‹¤ì œ ìš´ì˜ ì¤‘ì¸ Flask ì„œë²„ ì£¼ì†Œë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
            // ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œ: 'http://127.0.0.1:8000/api/analyzer/analyze'
            const apiUrl = 'https://api.dreamofenc.com/api/analyzer/analyze';

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text }) // í…ìŠ¤íŠ¸ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì „ì†¡
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        function renderResults(data) {
            const isLight = document.documentElement.classList.contains('light');

            // 1. ìš”ì•½
            dom.summary.textContent = data.summary;

            // 2. í‚¤ì›Œë“œ
            dom.keywords.innerHTML = '';
            data.keywords.slice(0, 5).forEach(kw => {
                const tag = document.createElement('span');
                tag.className = 'bg-teal-500/20 text-teal-300 text-xs font-medium px-2.5 py-1 rounded-full';
                tag.textContent = `#${kw.keyword} (${kw.frequency})`;
                dom.keywords.appendChild(tag);
            });

            // 3. ì›Œë“œ í´ë¼ìš°ë“œ
            const wordList = data.keywords.map(kw => [kw.keyword, kw.frequency * 5]);
            if (wordList.length > 0) {
                WordCloud(dom.wordCloudCanvas, {
                    list: wordList,
                    gridSize: 8,
                    weightFactor: 6,
                    fontFamily: "'Noto Sans KR', sans-serif",
                    color: isLight ? '#4b5563' : '#9ca3af',
                    backgroundColor: 'transparent',
                    rotateRatio: 0.3,
                    minRotation: -Math.PI / 6,
                    maxRotation: Math.PI / 6,
                });
            }

            // 4. ê°ì„± ë¶„ì„
            const score = data.sentiment.score;
            const percentage = (score - 1) * (100 / 9);
            dom.sentimentBar.style.width = `${percentage}%`;
            
            let colorClass = 'bg-yellow-400';
            if (score > 7) colorClass = 'bg-green-400';
            if (score < 4) colorClass = 'bg-red-400';
            dom.sentimentBar.className = `h-2.5 rounded-full ${colorClass}`;
            dom.sentimentText.textContent = `${data.sentiment.reason} (ì ìˆ˜: ${score}/10)`;

            // 5. í…ìŠ¤íŠ¸ í†µê³„
            dom.stats.innerHTML = `
                <div>
                    <div class="font-bold text-xl">${new Intl.NumberFormat().format(data.stats.charCount)}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">ê¸€ì ìˆ˜</div>
                </div>
                <div>
                    <div class="font-bold text-xl">${new Intl.NumberFormat().format(data.stats.wordCount)}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">ë‹¨ì–´ ìˆ˜</div>
                </div>
                <div class="col-span-2 mt-2">
                    <div class="font-bold text-xl">${data.stats.readability}</div>
                    <div class="text-xs" style="color: var(--text-secondary);">ì˜ˆìƒ ê°€ë…ì„±</div>
                </div>
            `;
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isLight = document.documentElement.classList.contains('light');
            dom.themeIcon.innerHTML = isLight 
                ? `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`
                : `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`;
        }

        // --- Initial Load ---
        dom.textInput.value = `[ê¸°ì‚¬] AI ê¸°ìˆ ì´ ë¹„ì¦ˆë‹ˆìŠ¤ í™˜ê²½ì— ë¯¸ì¹˜ëŠ” ì˜í–¥\n\nìµœê·¼ ì¸ê³µì§€ëŠ¥(AI) ê¸°ìˆ ì€ ì „ ì‚°ì—…ì— ê±¸ì³ í˜ì‹ ì ì¸ ë³€í™”ë¥¼ ì£¼ë„í•˜ê³  ìˆë‹¤. íŠ¹íˆ ìƒì„±í˜• AIì˜ ë“±ì¥ì€ ê¸°ì—…ì˜ ìƒì‚°ì„± í–¥ìƒì— í¬ê²Œ ê¸°ì—¬í•˜ë©° ê¸ì •ì ì¸ í‰ê°€ë¥¼ ë°›ê³  ìˆë‹¤. ë§ì€ ì „ë¬¸ê°€ë“¤ì€ AI ë„ì…ì´ ë‹¨ìˆœí•œ ë¹„ìš© ì ˆê°ì„ ë„˜ì–´, ìƒˆë¡œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ì°½ì¶œê³¼ ê³ ê° ê²½í—˜ ê°œì„ ì˜ í•µì‹¬ ë™ë ¥ì´ ë  ê²ƒì´ë¼ê³  ì „ë§í•œë‹¤. í•˜ì§€ë§Œ ì¼ê°ì—ì„œëŠ” AIë¡œ ì¸í•œ ì¼ìë¦¬ ê°ì†Œì™€ ë°ì´í„° í¸í–¥ì„± ë¬¸ì œì— ëŒ€í•œ ìš°ë ¤ë„ ì œê¸°ë˜ê³  ìˆì–´, ê¸°ìˆ  ë„ì…ê³¼ í•¨ê»˜ ì‚¬íšŒì , ìœ¤ë¦¬ì  ë…¼ì˜ê°€ ë°˜ë“œì‹œ ë³‘í–‰ë˜ì–´ì•¼ í•œë‹¤ëŠ” ëª©ì†Œë¦¬ê°€ ë†’ë‹¤. ê¸°ì—…ë“¤ì€ ì´ëŸ¬í•œ ë³€í™”ì— ëŠ¥ë™ì ìœ¼ë¡œ ëŒ€ì‘í•˜ê³ , AI ê¸°ìˆ ì„ ì±…ì„ê° ìˆê²Œ í™œìš©í•˜ëŠ” ì „ëµì„ ìˆ˜ë¦½í•´ì•¼ í•  ê²ƒì´ë‹¤.`;
        updateThemeIcon();
    </script>
</body>
</html>
