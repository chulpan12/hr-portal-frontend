<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>명예의 전당 - L.U.N.A.</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./assets/css/style.css" />
  <style>
    .glass-card {
      background: rgba(15, 18, 25, 0.9);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(100, 116, 139, 0.2);
    }
    .podium-card {
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .podium-card:hover {
      transform: translateY(-4px);
    }
    .gold-gradient {
      background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
    }
    .silver-gradient {
      background: linear-gradient(135deg, #94a3b8, #64748b, #475569);
    }
    .bronze-gradient {
      background: linear-gradient(135deg, #fb923c, #ea580c, #c2410c);
    }
    .gold-glow {
      box-shadow: 0 0 30px rgba(251, 191, 36, 0.3), 0 0 60px rgba(251, 191, 36, 0.1);
    }
    .silver-glow {
      box-shadow: 0 0 25px rgba(148, 163, 184, 0.3), 0 0 50px rgba(148, 163, 184, 0.1);
    }
    .bronze-glow {
      box-shadow: 0 0 20px rgba(251, 146, 60, 0.3), 0 0 40px rgba(251, 146, 60, 0.1);
    }
    .rank-row {
      transition: background 0.2s, transform 0.2s;
    }
    .rank-row:hover {
      background: rgba(51, 65, 85, 0.4);
      transform: translateX(4px);
    }
    .rank-row.current-user {
      background: rgba(34, 211, 238, 0.1);
      border-left: 3px solid #22d3ee;
    }
    .sticky-bar {
      background: rgba(15, 18, 25, 0.95);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(34, 211, 238, 0.3);
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body class="bg-[#0B0E14] text-slate-200 min-h-screen flex flex-col font-sans">

  <!-- 배경 효과 -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-amber-500 rounded-full blur-[150px] opacity-10"></div>
    <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500 rounded-full blur-[150px] opacity-10"></div>
    <div class="absolute top-1/2 right-1/3 w-64 h-64 bg-orange-500 rounded-full blur-[120px] opacity-5"></div>
  </div>

  <!-- 헤더 -->
  <header class="flex items-center justify-between px-6 py-4 bg-[#0f1219]/80 border-b border-slate-800 shrink-0 z-20">
    <div class="flex items-center gap-4">
      <!-- L.U.N.A. Brand Identity Block -->
      <a href="index.html" class="flex items-center gap-3 select-none cursor-pointer group">
        <!-- Neural Core Icon (Refined & Balanced) -->
        <div class="relative w-10 h-10 flex items-center justify-center">
          <!-- Ambient Background Glow -->
          <div class="absolute inset-0 bg-cyan-500/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
          <!-- Orbit Ring 1 (Solid, Slow Rotate) -->
          <div class="absolute inset-0 rounded-full border border-cyan-500/30 group-hover:border-cyan-400/60 transition-colors duration-500 animate-[spin_10s_linear_infinite]"></div>
          <!-- Orbit Ring 2 (Dashed, Counter Rotate) -->
          <div class="absolute w-[130%] h-[130%] rounded-full border border-dashed border-cyan-500/10 animate-[spin_20s_linear_infinite_reverse]"></div>
          <!-- Orbiting Electron (Fast Spin) -->
          <div class="absolute w-full h-full animate-[spin_3s_linear_infinite] group-hover:animate-[spin_1.5s_linear_infinite]">
            <div class="w-1.5 h-1.5 bg-cyan-300 rounded-full absolute -top-0.5 left-1/2 -translate-x-1/2 shadow-[0_0_10px_#22d3ee]"></div>
          </div>
          <!-- Inner Core (Floating & Breathing) -->
          <div class="relative w-5 h-5 rounded-full bg-gradient-to-tr from-cyan-600 to-cyan-300 shadow-lg shadow-cyan-500/30 z-10 group-hover:scale-110 group-hover:shadow-cyan-400/60 transition-all duration-500 animate-[float_3s_ease-in-out_infinite]">
            <div class="absolute inset-0 bg-white/40 rounded-full animate-pulse"></div>
          </div>
        </div>
        <!-- Typography Lockup (Visual Balance Logic) -->
        <div class="flex flex-col justify-center h-full">
          <h1 class="text-xl font-bold leading-none tracking-[0.2em] -mr-[0.2em]" style="font-family: 'Space Mono', monospace;">
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-100 via-white to-cyan-400 group-hover:from-white group-hover:to-cyan-300 transition-all duration-300">LUNA</span>
          </h1>
          <!-- Decorative Divider Line (Expands on hover) -->
          <div class="w-full h-px bg-gradient-to-r from-cyan-500/50 via-cyan-500/20 to-transparent my-1 origin-left scale-x-50 group-hover:scale-x-100 transition-transform duration-500 ease-out"></div>
          <span class="text-[8px] text-cyan-500/60 tracking-[0.12em] font-medium leading-none uppercase group-hover:text-cyan-400 transition-colors duration-300 whitespace-nowrap" style="font-family: 'JetBrains Mono', monospace;">
            Logic Unified Neural Advisor
          </span>
        </div>
      </a>
      <div class="w-px h-8 bg-slate-700"></div>
      <div>
        <h1 class="text-xl font-bold tracking-tight text-white flex items-center gap-2">
          <i class="fas fa-trophy text-amber-400"></i>명예의 전당
        </h1>
        <p class="text-xs text-slate-500">Hall of Fame</p>
      </div>
    </div>
    
    <div class="flex items-center gap-3">
      <a href="index.html" class="text-sm text-slate-400 hover:text-white transition-colors px-3 py-2 rounded hover:bg-slate-800">
        <i class="fas fa-home mr-1"></i>홈으로
      </a>
      <a href="dashboard.html" class="text-sm text-cyan-400 hover:text-cyan-300 transition-colors px-3 py-2 rounded hover:bg-slate-800">
        <i class="fas fa-chart-line mr-1"></i>대시보드
      </a>
    </div>
  </header>

  <!-- 메인 컨텐츠 -->
  <main class="flex-1 relative z-10 overflow-y-auto pb-24">
    <div class="max-w-4xl mx-auto px-6 py-8">
      
      <!-- 로딩 상태 -->
      <div id="loading-container" class="flex flex-col items-center justify-center py-20">
        <div class="w-16 h-16 border-4 border-amber-500/20 border-t-amber-500 rounded-full animate-spin mb-4"></div>
        <p class="text-slate-400">랭킹 데이터를 불러오는 중...</p>
      </div>
      
      <!-- 에러 상태 -->
      <div id="error-container" class="hidden">
        <div class="glass-card rounded-xl p-8 text-center">
          <i class="fas fa-exclamation-triangle text-4xl text-amber-500 mb-4"></i>
          <h3 class="text-lg font-semibold text-white mb-2">랭킹을 불러올 수 없습니다</h3>
          <p id="error-message" class="text-slate-400 mb-4">잠시 후 다시 시도해주세요.</p>
          <button onclick="loadLeaderboard()" class="px-4 py-2 bg-amber-600 hover:bg-amber-500 rounded text-white text-sm transition-colors">
            <i class="fas fa-redo mr-1"></i>다시 시도
          </button>
        </div>
      </div>
      
      <!-- 랭킹 컨텐츠 -->
      <div id="leaderboard-content" class="hidden">
        
        <!-- 타이틀 섹션 -->
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold text-white mb-2">
            <i class="fas fa-crown text-amber-400 mr-2 float-animation"></i>
            XP 랭킹 Top 50
          </h2>
          <p class="text-slate-400 text-sm">가장 열정적으로 학습한 동료들을 만나보세요</p>
        </div>
        
        <!-- Top 3 포디움 -->
        <div class="grid grid-cols-3 gap-4 mb-8">
          <!-- 2등 -->
          <div id="podium-2" class="podium-card glass-card rounded-xl p-4 pt-8 silver-glow relative order-1">
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-8 silver-gradient rounded-full flex items-center justify-center font-bold text-white shadow-lg">
              2
            </div>
            <div class="text-center">
              <div class="w-14 h-14 mx-auto mb-3 rounded-full bg-slate-700 flex items-center justify-center">
                <i class="fas fa-user text-slate-400 text-xl"></i>
              </div>
              <h3 class="font-semibold text-white truncate" id="rank2-name">-</h3>
              <p class="text-xs text-slate-500 mb-2" id="rank2-username">@-</p>
              <div class="flex items-center justify-center gap-2 text-sm">
                <span class="text-amber-400 font-bold" id="rank2-xp">0 XP</span>
                <span class="text-xs px-1.5 py-0.5 bg-slate-700 rounded text-slate-300" id="rank2-level">Lv.0</span>
              </div>
            </div>
          </div>
          
          <!-- 1등 (가운데, 더 높게) -->
          <div id="podium-1" class="podium-card glass-card rounded-xl p-4 pt-8 -mt-4 gold-glow relative order-2">
            <div class="absolute -top-4 left-1/2 -translate-x-1/2 w-10 h-10 gold-gradient rounded-full flex items-center justify-center font-bold text-white shadow-lg text-lg">
              <i class="fas fa-crown"></i>
            </div>
            <div class="text-center">
              <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-gradient-to-br from-amber-500/30 to-orange-600/30 border-2 border-amber-500/50 flex items-center justify-center">
                <i class="fas fa-user text-amber-400 text-2xl"></i>
              </div>
              <h3 class="font-bold text-amber-400 truncate text-lg" id="rank1-name">-</h3>
              <p class="text-xs text-slate-500 mb-2" id="rank1-username">@-</p>
              <div class="flex items-center justify-center gap-2 text-sm">
                <span class="text-amber-400 font-bold text-lg" id="rank1-xp">0 XP</span>
                <span class="text-xs px-2 py-0.5 bg-amber-500/20 rounded text-amber-300 font-medium" id="rank1-level">Lv.0</span>
              </div>
            </div>
          </div>
          
          <!-- 3등 -->
          <div id="podium-3" class="podium-card glass-card rounded-xl p-4 pt-8 bronze-glow relative order-3">
            <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-8 bronze-gradient rounded-full flex items-center justify-center font-bold text-white shadow-lg">
              3
            </div>
            <div class="text-center">
              <div class="w-14 h-14 mx-auto mb-3 rounded-full bg-orange-900/30 flex items-center justify-center">
                <i class="fas fa-user text-orange-400 text-xl"></i>
              </div>
              <h3 class="font-semibold text-white truncate" id="rank3-name">-</h3>
              <p class="text-xs text-slate-500 mb-2" id="rank3-username">@-</p>
              <div class="flex items-center justify-center gap-2 text-sm">
                <span class="text-amber-400 font-bold" id="rank3-xp">0 XP</span>
                <span class="text-xs px-1.5 py-0.5 bg-slate-700 rounded text-slate-300" id="rank3-level">Lv.0</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 4등 이후 리스트 -->
        <div class="glass-card rounded-xl overflow-hidden">
          <div class="px-4 py-3 border-b border-slate-700/50 bg-slate-800/30">
            <div class="grid grid-cols-12 text-xs font-medium text-slate-500 uppercase tracking-wider">
              <div class="col-span-1 text-center">#</div>
              <div class="col-span-5">학습자</div>
              <div class="col-span-3 text-right">XP</div>
              <div class="col-span-3 text-right">레벨</div>
            </div>
          </div>
          
          <div id="ranking-list" class="divide-y divide-slate-800/50">
            <!-- 랭킹 행들이 여기에 동적으로 추가됩니다 -->
          </div>
          
          <!-- 빈 상태 -->
          <div id="empty-list" class="hidden py-8 text-center text-slate-500">
            <i class="fas fa-users text-3xl mb-2 opacity-50"></i>
            <p>아직 학습 기록이 있는 사용자가 없습니다.</p>
          </div>
        </div>
        
      </div>
    </div>
  </main>

  <!-- 내 순위 고정 바 -->
  <div id="my-rank-bar" class="hidden fixed bottom-0 left-0 right-0 sticky-bar px-6 py-4 z-30">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-cyan-500/30 to-blue-600/30 border-2 border-cyan-500/50 flex items-center justify-center">
            <i class="fas fa-user text-cyan-400 text-lg"></i>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="text-white font-semibold" id="my-name">-</span>
              <span class="text-xs px-2 py-0.5 bg-cyan-500/20 rounded text-cyan-300">내 순위</span>
            </div>
            <span class="text-xs text-slate-500" id="my-username">@-</span>
          </div>
        </div>
        
        <div class="flex items-center gap-6">
          <div class="text-center">
            <div class="text-2xl font-bold text-cyan-400" id="my-rank">#-</div>
            <div class="text-xs text-slate-500">순위</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-amber-400" id="my-xp">0</div>
            <div class="text-xs text-slate-500">XP</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-bold text-purple-400" id="my-level">0</div>
            <div class="text-xs text-slate-500">레벨</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { getJSON } from './assets/js/config.js';
    
    let leaderboardData = null;
    
    // 페이지 로드 시 랭킹 불러오기
    document.addEventListener('DOMContentLoaded', () => {
      loadLeaderboard();
    });
    
    // 랭킹 데이터 로드
    async function loadLeaderboard() {
      showLoading(true);
      hideError();
      
      try {
        leaderboardData = await getJSON('/leaderboard');
        renderLeaderboard();
        showContent();
      } catch (error) {
        console.error('[Leaderboard] 로드 실패:', error);
        showError(error.message);
      }
    }
    
    // 랭킹 렌더링
    function renderLeaderboard() {
      if (!leaderboardData) return;
      
      // API 응답: { leaders: [...], my_rank: {...} }
      const { leaders, my_rank } = leaderboardData;
      
      // Top 3 포디움 렌더링
      renderPodium(leaders.slice(0, 3));
      
      // 4등 이후 리스트 렌더링
      renderRankingList(leaders.slice(3), my_rank?.rank);
      
      // 내 순위 바 렌더링
      if (my_rank) {
        renderMyRank(my_rank);
      }
    }
    
    // Top 3 포디움 렌더링
    function renderPodium(top3) {
      top3.forEach((user, index) => {
        const rank = index + 1;
        const nameEl = document.getElementById(`rank${rank}-name`);
        const usernameEl = document.getElementById(`rank${rank}-username`);
        const xpEl = document.getElementById(`rank${rank}-xp`);
        const levelEl = document.getElementById(`rank${rank}-level`);
        
        if (nameEl) nameEl.textContent = user.name || user.username;
        if (usernameEl) usernameEl.textContent = `@${user.username}`;
        if (xpEl) xpEl.textContent = `${user.xp.toLocaleString()} XP`;
        if (levelEl) levelEl.textContent = `Lv.${user.level}`;
      });
      
      // 데이터가 부족한 경우 포디움 숨기기
      for (let i = top3.length + 1; i <= 3; i++) {
        const podiumEl = document.getElementById(`podium-${i}`);
        if (podiumEl) podiumEl.style.display = 'none';
      }
    }
    
    // 랭킹 리스트 렌더링 (4위 이후)
    function renderRankingList(rankings, myRank) {
      const listEl = document.getElementById('ranking-list');
      const emptyEl = document.getElementById('empty-list');
      
      if (!rankings || rankings.length === 0) {
        listEl.innerHTML = '';
        emptyEl.classList.remove('hidden');
        return;
      }
      
      emptyEl.classList.add('hidden');
      listEl.innerHTML = rankings.map((user, index) => {
        const rank = index + 4; // 4위부터 시작
        const isCurrentUser = myRank && rank === myRank;
        
        return `
          <div class="rank-row grid grid-cols-12 items-center px-4 py-3 ${isCurrentUser ? 'current-user' : ''}">
            <div class="col-span-1 text-center">
              <span class="text-sm font-medium ${isCurrentUser ? 'text-cyan-400' : 'text-slate-400'}">${rank}</span>
            </div>
            <div class="col-span-5 flex items-center gap-3">
              <div class="w-8 h-8 rounded-full ${isCurrentUser ? 'bg-cyan-500/20' : 'bg-slate-700'} flex items-center justify-center">
                <i class="fas fa-user ${isCurrentUser ? 'text-cyan-400' : 'text-slate-500'} text-xs"></i>
              </div>
              <div class="min-w-0">
                <div class="font-medium ${isCurrentUser ? 'text-cyan-400' : 'text-white'} truncate">${user.name || user.username}</div>
                <div class="text-xs text-slate-500 truncate">@${user.username}</div>
              </div>
            </div>
            <div class="col-span-3 text-right">
              <span class="text-amber-400 font-medium">${user.xp.toLocaleString()}</span>
              <span class="text-xs text-slate-500 ml-1">XP</span>
            </div>
            <div class="col-span-3 text-right">
              <span class="text-xs px-2 py-1 bg-slate-700/50 rounded ${isCurrentUser ? 'text-cyan-300' : 'text-slate-300'}">Lv.${user.level}</span>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // 내 순위 바 렌더링
    function renderMyRank(myRank) {
      const bar = document.getElementById('my-rank-bar');
      
      document.getElementById('my-name').textContent = myRank.name || myRank.username;
      document.getElementById('my-username').textContent = `@${myRank.username}`;
      document.getElementById('my-rank').textContent = myRank.rank ? `#${myRank.rank}` : '순위 없음';
      document.getElementById('my-xp').textContent = (myRank.xp || 0).toLocaleString();
      document.getElementById('my-level').textContent = myRank.level || 0;
      
      bar.classList.remove('hidden');
    }
    
    // UI 헬퍼 함수들
    function showLoading(show) {
      document.getElementById('loading-container').classList.toggle('hidden', !show);
    }
    
    function showContent() {
      showLoading(false);
      document.getElementById('leaderboard-content').classList.remove('hidden');
    }
    
    function showError(message) {
      showLoading(false);
      document.getElementById('error-message').textContent = message;
      document.getElementById('error-container').classList.remove('hidden');
    }
    
    function hideError() {
      document.getElementById('error-container').classList.add('hidden');
    }
    
    // 전역으로 내보내기 (retry 버튼용)
    window.loadLeaderboard = loadLeaderboard;
  </script>
</body>
</html>
