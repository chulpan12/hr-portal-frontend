<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LUNA - System Initialization</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Fonts: Next Gen 페이지와 통일 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+KR:wght@300;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />

  <script>
      tailwind.config = {
          darkMode: 'class',
          theme: {
              extend: {
                  fontFamily: {
                      sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                      mono: ['Space Mono', 'monospace'],
                  },
                  colors: {
                      background: '#030712', // Next Gen Background
                      luna: '#00ffff',
                  },
                  animation: {
                      'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                      'shimmer': 'shimmer 2s linear infinite',
                  },
                  keyframes: {
                      shimmer: {
                          '0%': { backgroundPosition: '200% 0' },
                          '100%': { backgroundPosition: '-200% 0' }
                      }
                  }
              }
          }
      }
  </script>

  <style>
    /* 1. Base Setup */
    body, html {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background-color: #030712; /* Deep Dark Blue */
      color: white;
    }

    /* Next Gen Background Grid */
    .bg-grid {
        background-size: 50px 50px;
        background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                          linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
        -webkit-mask-image: radial-gradient(circle at center, black 30%, transparent 80%);
        position: fixed; inset: 0; z-index: 0;
        pointer-events: none;
    }

    #canvas-container {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%; z-index: 1;
      /* mix-blend-mode 삭제: p5 clear() 사용으로 투명 배경 유지 */
    }

    .vignette {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 2;
      background: radial-gradient(circle, transparent 40%, #030712 100%);
    }

    /* 3. UI Elements Layout */
    #ui-layer {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 10;
      pointer-events: none;
      display: flex; flex-direction: column;
      justify-content: space-between; 
      align-items: center;
      padding: 3rem 0;
    }

    /* Top Badge Style (Next Gen Style) */
    .top-badge {
      margin-top: 4rem;
      opacity: 0;
      animation: fadeInDown 1.5s ease forwards 2s;
    }

    /* Bottom Area Styling */
    .bottom-container {
      margin-bottom: 8vh;
      display: flex; flex-direction: column; align-items: center; 
      gap: 2rem;
      pointer-events: auto;
      width: 100%;
      z-index: 20;
    }

    /* Korean Slogan Style */
    .slogan-wrapper {
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 1.8s;
      text-align: center;
      padding: 0 20px;
    }

    .korean-slogan {
      font-family: 'Noto Sans KR', sans-serif;
      font-weight: 900;
      line-height: 1.3;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, #ffffff 0%, #cffafe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.2));
    }
    
    @media (min-width: 1024px) { .korean-slogan { font-size: 2.2rem; } }
    @media (max-width: 1023px) { .korean-slogan { font-size: 1.5rem; } }

    /* Acronym Style */
    .acronym-container {
      display: flex; align-items: center; gap: 1.5rem;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 2.2s;
    }
    .arch-line {
      width: 40px; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5));
    }
    .arch-line.right { transform: scaleX(-1); }
    
    .acronym-text {
      font-family: 'Space Mono', monospace;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
      letter-spacing: 0.15em;
    }
    .acronym-text b { color: #00ffff; text-shadow: 0 0 10px rgba(0,255,255,0.6); }

    /* Modern Button Style */
    .btn-wrapper {
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 2.5s;
    }

    .luna-btn {
        position: relative;
        background: rgba(0, 255, 255, 0.05);
        border: 1px solid rgba(0, 255, 255, 0.2);
        color: #00ffff;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 1rem;
        padding: 16px 40px;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
        backdrop-filter: blur(10px);
        letter-spacing: 0.1em;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.05);
    }

    .luna-btn::before {
        content: '';
        position: absolute;
        top: 0; left: -100%; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
        transition: 0.5s;
    }

    .luna-btn:hover {
        background: rgba(0, 255, 255, 0.15);
        border-color: rgba(0, 255, 255, 0.6);
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        transform: translateY(-2px);
        color: white;
    }

    .luna-btn:hover::before {
        left: 100%;
    }

    /* Animations */
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .warp-transition {
      animation: warpEffect 1.2s cubic-bezier(0.7, 0, 0.84, 0) forwards;
      pointer-events: none;
    }
    @keyframes warpEffect {
      0% { transform: scale(1); filter: brightness(1) blur(0); opacity: 1; }
      100% { transform: scale(5); filter: brightness(5) blur(20px); opacity: 0; }
    }
  </style>
</head>
<body>

  <!-- Background Grid -->
  <div class="bg-grid"></div>
  
  <div id="canvas-container"></div>
  <div class="vignette"></div>

  <div id="ui-layer">
    <!-- Top Badge -->
    <div class="top-badge">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-cyan-500/30 bg-cyan-950/30 text-cyan-300 text-xs font-mono tracking-widest backdrop-blur-sm shadow-[0_0_15px_rgba(0,255,255,0.1)]">
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400 animate-pulse"></span>
            SYSTEM ONLINE
        </div>
    </div>

    <div class="bottom-container">
      
      <!-- Slogan -->
      <div class="slogan-wrapper">
        <h1 class="korean-slogan">
          당신의 코딩 논리를 깨우는,<br class="md:hidden"/>
          AI 학습 어드바이저
        </h1>
      </div>

      <!-- Acronym -->
      <div class="acronym-container">
        <div class="arch-line"></div>
        <div class="acronym-text">
          <span><b>L</b>OGIC</span> &nbsp;
          <span><b>U</b>NIFIED</span> &nbsp;
          <span><b>N</b>EURAL</span> &nbsp;
          <span><b>A</b>DVISOR</span>
        </div>
        <div class="arch-line right"></div>
      </div>

      <!-- Button -->
      <div class="btn-wrapper">
        <button id="start-trigger" class="luna-btn group">
          <span class="relative z-10">INITIALIZE_WORKSPACE</span>
          <!-- Corner Accents -->
          <div class="absolute top-0 left-0 w-2 h-2 border-t border-l border-cyan-400 opacity-50 group-hover:opacity-100 transition-opacity"></div>
          <div class="absolute bottom-0 right-0 w-2 h-2 border-b border-r border-cyan-400 opacity-50 group-hover:opacity-100 transition-opacity"></div>
        </button>
      </div>

    </div>
  </div>

  <script>
    const CONFIG = {
      text: "LUNA",
      baseParticleCount: 3000, 
      starCount: 400,
      mouseRadius: 180,
      starSpeedBase: 0.5, // 조금 더 차분하게 조정
      starSpeedWarp: 80,
      // Colors adjusted to match Next Gen Theme (Cyan, Indigo, Purple)
      colors: [
        [0, 255, 255],    // Cyan
        [99, 102, 241],   // Indigo (Next Gen Accent)
        [192, 132, 252],  // Purple
        [255, 255, 255]   // White
      ]
    };

    let particles = [];
    let stars = [];
    let mode = 'intro'; 
    let minX, maxX;
    let systemInitialized = false;

    function setup() {
      let canvas = createCanvas(windowWidth, windowHeight);
      canvas.parent('canvas-container');
      pixelDensity(min(window.devicePixelRatio, 2));
      
      // Space Mono 로드 대기
      document.fonts.load("700 100px 'Space Mono'").then(() => {
        setTimeout(() => {
          initSystem();
          systemInitialized = true;
        }, 100);
      }).catch(err => {
          initSystem();
          systemInitialized = true;
      });
    }

    function initSystem() {
      particles = [];
      stars = [];

      let pg = createGraphics(width, height);
      pg.pixelDensity(1); 
      pg.background(0);
      pg.textFont('Space Mono'); 
      pg.textStyle(BOLD);
      pg.textAlign(CENTER, CENTER);
      
      // 텍스트 위치: 중앙보다 살짝 위 (UI 공간 확보)
      pg.text(CONFIG.text, width/2, height/2 - 40); 

      // 텍스트 크기
      let fontSize = min(width * 0.22, 500); 
      if (width < 600) fontSize = width * 0.28; 
      
      pg.textSize(fontSize);
      pg.fill(255);
      pg.text(CONFIG.text, width/2, height/2 - 40); 

      pg.loadPixels();
      
      let step = 2; 
      if (width < 800) step = 3; 

      minX = width; maxX = 0;
      let tempPoints = [];

      for (let y = 0; y < height; y += step) {
        for (let x = 0; x < width; x += step) {
          let index = (x + y * width) * 4;
          if (index < pg.pixels.length && pg.pixels[index] > 128) {
            if (random(1) < 0.9) {
              tempPoints.push(createVector(x, y));
              if (x < minX) minX = x;
              if (x > maxX) maxX = x;
            }
          }
        }
      }
      pg.remove(); 

      if (tempPoints.length > 0) {
        let textBoundingCenter = (minX + maxX) / 2;
        let screenCenter = width / 2;
        let offsetX = screenCenter - textBoundingCenter; // 중앙 정렬 보정
        
        for (let pt of tempPoints) {
          pt.x += offsetX;
        }
        minX += offsetX;
        maxX += offsetX;
      }

      let maxP = width < 800 ? 1500 : 3500;
      let count = min(tempPoints.length, maxP);
      
      for (let i = 0; i < count; i++) {
        let rndIdx = floor(random(tempPoints.length));
        let pt = tempPoints[rndIdx];
        tempPoints.splice(rndIdx, 1);

        let t = map(pt.x, minX, maxX, 0, 1);
        let c = getGradientColor(t);
        particles.push(new GlowParticle(pt.x, pt.y, c));
      }

      for (let i = 0; i < CONFIG.starCount; i++) {
        stars.push(new Star());
      }
    }

    function getGradientColor(t) {
      let segments = CONFIG.colors.length - 1;
      let idx = floor(t * segments);
      let amt = (t * segments) - idx;
      if (idx < 0) idx = 0;
      if (idx >= segments) { idx = segments - 1; amt = 1; }
      let c1 = color(CONFIG.colors[idx]);
      let c2 = color(CONFIG.colors[idx + 1]);
      return lerpColor(c1, c2, amt);
    }

    function draw() {
      if (mode === 'warping') {
          background(3, 7, 18, 40); // #030712 with alpha for trail
      } else {
          clear(); // 투명하게 처리하여 CSS 배경(Grid)이 보이도록 함
      }

      if (!systemInitialized) return;

      let mouse = createVector(mouseX, mouseY);
      
      blendMode(ADD); 

      push();
      translate(width/2, height/2);
      let targetSpeed = (mode === 'warping') ? CONFIG.starSpeedWarp : CONFIG.starSpeedBase;
      if (mode !== 'warping') targetSpeed += map(mouseY, 0, height, 0, 1.5);
      
      for (let star of stars) {
        star.update(targetSpeed);
        star.show();
      }
      pop();

      for (let p of particles) {
        p.behavior(mouse);
        p.update();
        p.show();
      }

      blendMode(BLEND);
    }

    class GlowParticle {
      constructor(tx, ty, col) {
        this.target = createVector(tx, ty);
        this.pos = createVector(random(width), random(height));
        this.vel = createVector(0, 0);
        this.acc = createVector(0, 0);
        this.baseColor = col;
        this.r = random(1.5, 3.5);
        this.maxSpeed = 15;
        this.maxForce = 0.9;
        this.noiseOffset = createVector(random(1000), random(1000));
      }

      behavior(mouse) {
        let arrive = this.arrive(this.target);
        let dx = this.pos.x - mouse.x;
        let dy = this.pos.y - mouse.y;
        let distSq = dx*dx + dy*dy;
        let rSq = CONFIG.mouseRadius * CONFIG.mouseRadius;

        if (distSq < rSq) {
          let f = createVector(dx, dy);
          f.setMag(this.maxSpeed);
          f.sub(this.vel);
          f.limit(this.maxForce * 2.5);
          f.mult(4); 
          this.applyForce(f);
        }

        if (mode === 'warping') {
          let center = createVector(width/2, height/2);
          let dir = p5.Vector.sub(this.pos, center);
          dir.normalize();
          dir.mult(random(30, 80)); 
          this.applyForce(dir);
        } else {
          this.applyForce(arrive);
          let nX = (noise(this.noiseOffset.x + frameCount * 0.01) - 0.5) * 0.5;
          let nY = (noise(this.noiseOffset.y + frameCount * 0.01) - 0.5) * 0.5;
          this.applyForce(createVector(nX, nY));
        }
      }

      applyForce(f) { this.acc.add(f); }

      arrive(target) {
        let desired = p5.Vector.sub(target, this.pos);
        let d = desired.mag();
        let speed = this.maxSpeed;
        if (d < 100) speed = map(d, 0, 100, 0, this.maxSpeed);
        desired.setMag(speed);
        let steer = p5.Vector.sub(desired, this.vel);
        steer.limit(this.maxForce);
        return steer;
      }

      update() {
        this.pos.add(this.vel);
        this.vel.add(this.acc);
        this.acc.mult(0);
      }

      show() {
        // 색상 톤을 Next Gen 페이지에 맞춰 조금 더 선명하게 조정
        strokeWeight(this.r * 2.5); 
        stroke(red(this.baseColor), green(this.baseColor), blue(this.baseColor), 60); 
        point(this.pos.x, this.pos.y);

        strokeWeight(this.r * 1.0); 
        stroke(red(this.baseColor)+100, green(this.baseColor)+100, blue(this.baseColor)+100, 255); 
        point(this.pos.x, this.pos.y);
      }
    }

    class Star {
      constructor() {
        this.reset();
        this.z = random(width); 
      }
      reset() {
        this.x = random(-width, width);
        this.y = random(-height, height);
        this.z = random(width, width * 2);
        this.pz = this.z;
        let r = random(200, 255);
        let g = random(230, 255);
        let b = 255;
        this.color = color(r, g, b);
      }
      update(speed) {
        this.z -= speed;
        if (this.z < 1) {
          this.reset();
          this.z = width;
          this.pz = this.z;
        }
      }
      show() {
        let sx = map(this.x / this.z, 0, 1, 0, width);
        let sy = map(this.y / this.z, 0, 1, 0, height);
        let tailFactor = mode === 'warping' ? 2.5 : 0.6; 
        let pz_calc = this.z + (this.pz - this.z) * tailFactor + (mode==='warping'?50:10); 
        let px = map(this.x / pz_calc, 0, 1, 0, width);
        let py = map(this.y / pz_calc, 0, 1, 0, height);
        let alpha = map(this.z, 0, width, 255, 0);
        if (mode !== 'warping' && random(1) < 0.05) alpha = random(150, 255);

        strokeWeight(map(this.z, 0, width, 2.5, 0.1));
        stroke(red(this.color), green(this.color), blue(this.color), alpha);
        line(px, py, sx, sy);
        this.pz = this.z;
      }
    }

    const triggerBtn = document.getElementById('start-trigger');
    triggerBtn.addEventListener('click', () => {
      mode = 'warping';
      document.body.classList.add('warp-transition');
      document.getElementById('ui-layer').style.transition = 'opacity 0.2s';
      document.getElementById('ui-layer').style.opacity = 0;
      setTimeout(() => { window.location.href = 'index.html'; }, 1200);
    });
    
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      initSystem();
    }
  </script>
</body>
</html>