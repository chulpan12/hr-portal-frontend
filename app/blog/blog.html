<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamofEnC - Blog</title>
    <link rel="stylesheet" href="../../assets/blog.css">
</head>
<body>

    <div class="container">
        <!-- 페이지 타이틀 -->
        <h1 class="page-title">My Personal Blog</h1>

        <!-- 블로그 글 목록이 표시될 영역 -->
        <div id="post-list-view">
            <div id="post-list-container" class="post-list">
                <!-- 자바스크립트로 포스트 카드가 여기에 채워집니다. -->
            </div>
        </div>

        <!-- 블로그 글 상세 내용이 표시될 영역 (초기에는 숨김) -->
        <div id="post-detail-view" style="display: none;">
            <!-- 자바스크립트로 포스트 상세 내용이 여기에 채워집니다. -->
        </div>
        
        <!-- 홈으로 돌아가기 버튼 -->
        <a href="../../index.html" class="back-button" style="margin-right: 10px;">홈으로</a>
        
        <!-- 목록으로 돌아가기 버튼 (상세보기에만 표시됨) -->
        <button id="back-to-list" class="back-button" style="display: none;">목록으로</button>

    </div>

    <!-- 블로그 데이터 및 렌더링 스크립트 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const postListContainer = document.getElementById('post-list-container');
            const postListView = document.getElementById('post-list-view');
            const postDetailView = document.getElementById('post-detail-view');
            const backToListButton = document.getElementById('back-to-list');

            // --- API 설정 ---
            // 실제 배포된 백엔드 API 주소를 사용해야 합니다.
            // 예: https://api.dreamofenc.com
            // 로컬 테스트 시: http://127.0.0.1:8000
            const API_BASE_URL = 'https://api.dreamofenc.com'; 

            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');

            const renderContent = () => {
                const urlParams = new URLSearchParams(window.location.search);
                const postId = urlParams.get('id');

                if (postId) {
                    fetchPostDetail(postId);
                } else {
                    fetchPostList();
                }
            };
            
            // API로부터 게시물 목록을 가져와 표시
            const fetchPostList = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/blog/posts`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const posts = await response.json();

                    displayPostList(posts);
                } catch (error) {
                    console.error('Error fetching posts:', error);
                    postListContainer.innerHTML = '<p>게시물을 불러오는 데 실패했습니다.</p>';
                }
            };

            // 게시물 목록 표시
            const displayPostList = (posts) => {
                postListView.style.display = 'block';
                postDetailView.style.display = 'none';
                backToListButton.style.display = 'none';

                postListContainer.innerHTML = ''; // 기존 목록 초기화
                posts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.className = 'post-card';
                    
                    const postContent = post.content.length > 300 
                        ? post.content.substring(0, 300) + '...'
                        : post.content;

                    postCard.innerHTML = `
                        <h2 class="post-title">${post.title}</h2>
                        <p class="post-meta">${post.date} by ${post.author}</p>
                        <div class="post-content">${postContent}</div>
                    `;
                    postCard.addEventListener('click', () => {
                        window.location.href = `?id=${post.id}`;
                    });
                    postListContainer.appendChild(postCard);
                });
            };

            // API로부터 특정 게시물을 가져와 표시
            const fetchPostDetail = async (id) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/blog/posts/${id}`);
                    if (!response.ok) throw new Error('Post not found');
                    const post = await response.json();
                    
                    displayPostDetail(post);
                } catch (error) {
                    console.error('Error fetching post detail:', error);
                    postDetailView.innerHTML = `<p>게시물을 불러오는 데 실패했습니다.</p>`;
                }
            };

            // 게시물 상세 내용 표시
            const displayPostDetail = (post) => {
                postListView.style.display = 'none';
                postDetailView.style.display = 'block';
                backToListButton.style.display = 'inline-block';

                postDetailView.innerHTML = `
                    <h2 class="post-title">${post.title}</h2>
                    <p class="post-meta">${post.date} by ${post.author}</p>
                    <div class="post-content">${post.content}</div>
                    <button class="cta-button" onclick="location.href='editor.html?id=${post.id}'" style="margin-top: 20px;">수정하기</button>
                `;
            };

            // '목록으로' 버튼 이벤트 리스너
            backToListButton.addEventListener('click', () => {
                window.location.href = 'blog.html';
            });

            renderContent();
        });
    </script>

</body>
</html> 