<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamofEnC - Tech Blog</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                    },
                    colors: {
                        background: '#030712',
                        surface: '#0B1121',
                        accent: '#6366f1',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #030712;
            color: #e2e8f0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ë°°ê²½ íš¨ê³¼ */
        .bg-grid {
            background-size: 50px 50px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            mask-image: radial-gradient(ellipse at center, black 40%, transparent 80%);
            -webkit-mask-image: radial-gradient(ellipse at center, black 40%, transparent 80%);
            position: fixed;
            inset: 0;
            z-index: -2;
            pointer-events: none;
        }

        .bg-glow-blob {
            position: fixed;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, rgba(0, 0, 0, 0) 70%);
            border-radius: 50%;
            top: -20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: -1;
            filter: blur(80px);
        }

        /* í…ìŠ¤íŠ¸ ê·¸ë¼ë°ì´ì…˜ */
        .text-gradient {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ (Spotlight ì ìš©) */
        .blog-card {
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            --mouse-x: 0px;
            --mouse-y: 0px;
        }

        .blog-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: inherit;
            background: radial-gradient(
                600px circle at var(--mouse-x) var(--mouse-y),
                rgba(255, 255, 255, 0.06),
                transparent 40%
            );
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 2;
            pointer-events: none;
        }

        .blog-card:hover::before { opacity: 1; }
        .blog-card:hover { transform: translateY(-5px); border-color: rgba(99, 102, 241, 0.3); }

        .card-image-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            overflow: hidden;
            background: #111;
        }

        .card-image-wrapper img {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            opacity: 0.8;
        }

        .blog-card:hover .card-image-wrapper img {
            transform: scale(1.05);
            opacity: 1;
        }

        /* í”Œë¡œíŒ… ë… (ë„¤ë¹„ê²Œì´ì…˜) */
        .floating-dock {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            display: flex;
            gap: 1.5rem;
            align-items: center;
            z-index: 50;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .dock-item {
            position: relative;
            color: #94a3b8;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
        }

        .dock-item:hover {
            color: #fff;
            transform: translateY(-3px);
        }

        .dock-item.active {
            color: #818cf8;
        }

        .dock-tooltip {
            position: absolute;
            top: -40px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            white-space: nowrap;
        }

        .dock-item:hover .dock-tooltip { opacity: 1; }

        /* ìƒì„¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #d1d5db;
        }
        .post-content img {
            border-radius: 0.75rem;
            margin: 2rem auto;
            max-width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .post-content h2 { font-size: 1.8rem; font-weight: 700; color: white; margin-top: 3rem; margin-bottom: 1.5rem; }
        .post-content h3 { font-size: 1.4rem; font-weight: 600; color: white; margin-top: 2rem; margin-bottom: 1rem; }
        .post-content p { margin-bottom: 1.5rem; }
        .post-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .post-content strong { color: #818cf8; font-weight: 600; }
        .post-content blockquote {
            border-left: 4px solid #6366f1;
            padding-left: 1rem;
            font-style: italic;
            color: #9ca3af;
            background: rgba(99, 102, 241, 0.1);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 1.5rem 0;
        }

        /* ëŒ“ê¸€ í¼ */
        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.2s;
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: #818cf8;
            outline: none;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #6366f1;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #030712; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }
    </style>
</head>
<body>

    <!-- ë°°ê²½ ìš”ì†Œ -->
    <div class="bg-grid"></div>
    <div class="bg-glow-blob"></div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-5xl mx-auto px-4 py-8 pb-32 min-h-screen flex flex-col">
        
        <!-- í—¤ë” -->
        <header class="flex justify-between items-center mb-12 animate-fade-in">
            <div>
                <a href="../../index.html" class="flex items-center gap-2 group cursor-pointer text-gray-400 hover:text-white transition-colors mb-2 text-sm">
                    <i data-lucide="arrow-left" class="w-4 h-4 transition-transform group-hover:-translate-x-1"></i>
                    Back to Home
                </a>
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white">
                    Tech <span class="text-gradient">Blog</span>
                </h1>
                <p class="text-gray-400 mt-2 text-sm">AI, ìë™í™”, ê·¸ë¦¬ê³  ê¸°ìˆ ì  ì¸ì‚¬ì´íŠ¸ì˜ ê¸°ë¡</p>
            </div>
            <!-- ê¸€ì“°ê¸° ë²„íŠ¼ (ë°ìŠ¤í¬íƒ‘) -->
            <a href="editor_login.html" class="hidden md:flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-2.5 rounded-full text-sm font-semibold transition-all shadow-lg shadow-indigo-500/20">
                <i data-lucide="pen-tool" class="w-4 h-4"></i>
                ìƒˆ ê¸€ ì‘ì„±
            </a>
        </header>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loading-spinner" class="flex justify-center items-center py-20 hidden">
            <div class="spinner"></div>
        </div>

        <!-- 1. ê²Œì‹œë¬¼ ëª©ë¡ ë·° (Grid) -->
        <main id="post-list-view" class="w-full animate-slide-up">
            <div id="grid-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¹´ë“œê°€ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
            </div>
            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="empty-state" class="hidden text-center py-20">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/5 mb-4">
                    <i data-lucide="file-x" class="w-8 h-8 text-gray-500"></i>
                </div>
                <p class="text-gray-400">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </main>

        <!-- 2. ê²Œì‹œë¬¼ ìƒì„¸ ë·° -->
        <main id="post-detail-view" class="hidden animate-fade-in w-full max-w-3xl mx-auto">
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="flex justify-between mb-8 border-b border-white/10 pb-4">
                <div id="prev-post-btn-container"></div>
                <div id="next-post-btn-container"></div>
            </div>

            <!-- ë³¸ë¬¸ í—¤ë” -->
            <h1 id="detail-title" class="text-3xl md:text-4xl font-bold text-white mb-4 leading-tight"></h1>
            <div class="flex items-center gap-4 text-sm text-gray-400 mb-8">
                <div class="flex items-center gap-1">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span id="detail-date"></span>
                </div>
                <div class="flex items-center gap-1">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span id="detail-author"></span>
                </div>
                <div class="flex items-center gap-1 ml-auto">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                    <span id="detail-views"></span>
                </div>
            </div>

            <!-- ë³¸ë¬¸ ë‚´ìš© -->
            <article id="detail-content" class="post-content mb-16">
                <!-- ë‚´ìš© ì£¼ì… -->
            </article>

            <!-- êµ¬ë¶„ì„  -->
            <hr class="border-white/10 mb-12">

            <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
            <section id="comments-section" class="bg-gray-900/50 rounded-2xl p-6 border border-white/5">
                <div class="flex items-center gap-2 mb-6">
                    <i data-lucide="message-circle" class="text-indigo-400"></i>
                    <h3 class="text-xl font-bold text-white">Comments</h3>
                </div>

                <!-- ëŒ“ê¸€ ëª©ë¡ -->
                <div id="comments-list" class="space-y-4 mb-8"></div>

                <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
                <form id="comment-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="comment-author" placeholder="ì‘ì„±ì (ë‹‰ë„¤ì„)" required 
                               class="glass-input w-full px-4 py-3 rounded-xl text-sm placeholder-gray-500">
                        <input type="password" id="comment-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì •/ì‚­ì œìš©)" required 
                               class="glass-input w-full px-4 py-3 rounded-xl text-sm placeholder-gray-500">
                    </div>
                    <textarea id="comment-content" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..." required rows="3"
                              class="glass-input w-full px-4 py-3 rounded-xl text-sm placeholder-gray-500 resize-none"></textarea>
                    <div class="text-right">
                        <button type="submit" class="bg-white text-black hover:bg-gray-200 px-6 py-2 rounded-lg text-sm font-bold transition-colors">
                            ëŒ“ê¸€ ë“±ë¡
                        </button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <!-- í•˜ë‹¨ í”Œë¡œíŒ… ë… (ë„¤ë¹„ê²Œì´ì…˜) -->
    <nav class="floating-dock">
        <!-- í™ˆìœ¼ë¡œ -->
        <a href="../../index.html" class="dock-item" aria-label="Home">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span class="dock-tooltip">Home</span>
        </a>
        
        <!-- ëª©ë¡ìœ¼ë¡œ (ìƒì„¸ë·°ì—ì„œë§Œ í™œì„±í™”) -->
        <a href="#" id="dock-list" class="dock-item hidden" aria-label="List">
            <i data-lucide="layout-grid" class="w-5 h-5"></i>
            <span class="dock-tooltip">List</span>
        </a>

        <!-- ë’¤ë¡œê°€ê¸° (ìƒì„¸ë·°ì—ì„œë§Œ í™œì„±í™”) -->
        <a href="#" id="dock-back" class="dock-item hidden" aria-label="Back">
            <i data-lucide="arrow-left-circle" class="w-5 h-5"></i>
            <span class="dock-tooltip">Back</span>
        </a>

        <!-- êµ¬ë¶„ì„  -->
        <div class="w-px h-6 bg-white/10 mx-1"></div>

        <!-- ìƒˆ ê¸€ ì‘ì„± -->
        <a href="editor_login.html" class="dock-item" aria-label="New Post">
            <i data-lucide="pen-square" class="w-5 h-5"></i>
            <span class="dock-tooltip">Write</span>
        </a>

        <!-- ìˆ˜ì •í•˜ê¸° (ìƒì„¸ë·°ì—ì„œë§Œ í™œì„±í™”) -->
        <a href="#" id="dock-edit" class="dock-item hidden text-indigo-400" aria-label="Edit">
            <i data-lucide="edit-3" class="w-5 h-5"></i>
            <span class="dock-tooltip">Edit Post</span>
        </a>
    </nav>

    <script>
        // --- ì „ì—­ ì„¤ì • ë° ìœ í‹¸ë¦¬í‹° ---
        lucide.createIcons();
        
        const API_BASE_URL = 'https://api.dreamofenc.com';
        let currentPostId = null;
        let postListCache = [];

        // --- DOM Elements ---
        const views = {
            list: document.getElementById('post-list-view'),
            detail: document.getElementById('post-detail-view'),
            loading: document.getElementById('loading-spinner'),
            empty: document.getElementById('empty-state')
        };

        const dock = {
            list: document.getElementById('dock-list'),
            back: document.getElementById('dock-back'),
            edit: document.getElementById('dock-edit')
        };

        // --- í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸° ìƒì„±ê¸° ---
        const createTextPreview = (htmlString, maxLength = 120) => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;
            const text = tempDiv.textContent || tempDiv.innerText || "";
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        };

        // --- ë·° ì „í™˜ ë¡œì§ ---
        const switchView = (viewName) => {
            if (viewName === 'list') {
                views.list.classList.remove('hidden');
                views.detail.classList.add('hidden');
                
                // Dock ìƒíƒœ ì—…ë°ì´íŠ¸
                dock.list.classList.add('hidden');
                dock.back.classList.add('hidden');
                dock.edit.classList.add('hidden');
                
                // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨
                window.scrollTo(0, 0);
            } else if (viewName === 'detail') {
                views.list.classList.add('hidden');
                views.detail.classList.remove('hidden');

                // Dock ìƒíƒœ ì—…ë°ì´íŠ¸
                dock.list.classList.remove('hidden');
                dock.back.classList.remove('hidden');
                dock.edit.classList.remove('hidden');

                // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨
                window.scrollTo(0, 0);
            }
        };

        // --- ëª©ë¡ ë Œë”ë§ (Grid System) ---
        const renderBlogGrid = (posts) => {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';

            if (!posts || posts.length === 0) {
                views.empty.classList.remove('hidden');
                return;
            } else {
                views.empty.classList.add('hidden');
            }

            posts.forEach(post => {
                // ì´ë¯¸ì§€ ì¶”ì¶œ
                const imgMatch = post.content.match(/<img[^>]+src="([^">]+)"/);
                const imgSrc = imgMatch ? imgMatch[1] : `https://placehold.co/600x340/1f2937/e5e7eb?text=${encodeURIComponent(post.title.substring(0,2))}`;
                const previewText = createTextPreview(post.content);

                const card = document.createElement('div');
                card.className = 'blog-card group';
                card.innerHTML = `
                    <div class="card-image-wrapper">
                        <img src="${imgSrc}" alt="${post.title}" loading="lazy">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent opacity-60"></div>
                    </div>
                    <div class="p-6 flex flex-col flex-grow relative z-10">
                        <div class="flex items-center justify-between text-xs text-indigo-400 mb-2 font-mono">
                            <span>${post.date}</span>
                            <span class="flex items-center gap-1"><i data-lucide="eye" class="w-3 h-3"></i> ${post.views || 0}</span>
                        </div>
                        <h2 class="text-xl font-bold text-white mb-2 line-clamp-2 group-hover:text-indigo-300 transition-colors">${post.title}</h2>
                        <p class="text-gray-400 text-sm line-clamp-3 mb-4 flex-grow">${previewText}</p>
                        <div class="flex items-center justify-between pt-4 border-t border-white/5 mt-auto">
                            <span class="text-xs text-gray-500">by ${post.author}</span>
                            <span class="text-xs font-semibold text-white group-hover:underline flex items-center gap-1">
                                Read More <i data-lucide="arrow-right" class="w-3 h-3"></i>
                            </span>
                        </div>
                    </div>
                `;

                // ë§ˆìš°ìŠ¤ í˜¸ë²„ Spotlight íš¨ê³¼
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    card.style.setProperty('--mouse-x', `${x}px`);
                    card.style.setProperty('--mouse-y', `${y}px`);
                });

                card.addEventListener('click', () => {
                    history.pushState({ id: post.id }, '', `?id=${post.id}`);
                    fetchPostDetail(post.id);
                });

                container.appendChild(card);
            });
            lucide.createIcons();
        };

        // --- ìƒì„¸ ë‚´ìš© ë Œë”ë§ ---
        const fetchPostDetail = async (id) => {
            views.loading.classList.remove('hidden');
            switchView('detail'); // ë¨¼ì € í™”ë©´ ì „í™˜ (ë¡œë”© í‘œì‹œ)

            // ë¡œì»¬ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì²˜ë¦¬
            if (id === 'local-test-post') {
                const testPost = postListCache.find(p => p.id === 'local-test-post');
                if (testPost) {
                    displayPostDetail(testPost);
                    views.loading.classList.add('hidden');
                    return;
                }
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/blog/posts/${id}`);
                if (!response.ok) throw new Error('Post not found');
                const post = await response.json();
                displayPostDetail(post);
            } catch (error) {
                console.error(error);
                document.getElementById('detail-content').innerHTML = `<p class="text-red-400 text-center">ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;
            } finally {
                views.loading.classList.add('hidden');
            }
        };

        const displayPostDetail = (post) => {
            currentPostId = post.id;
            
            // ë‚´ìš© ì£¼ì…
            document.getElementById('detail-title').textContent = post.title;
            document.getElementById('detail-date').textContent = post.date;
            document.getElementById('detail-author').textContent = post.author;
            document.getElementById('detail-views').textContent = post.views || 0;
            document.getElementById('detail-content').innerHTML = post.content;

            // Dock ìˆ˜ì • ë²„íŠ¼ ë§í¬ ì—…ë°ì´íŠ¸
            dock.edit.href = `editor_login.html?id=${post.id}`;

            // ì´ì „/ë‹¤ìŒ ê¸€ ë²„íŠ¼ ì²˜ë¦¬
            const currentIdx = postListCache.findIndex(p => p.id == post.id); // íƒ€ì… ëŠìŠ¨í•œ ë¹„êµ ê¶Œì¥
            
            const prevContainer = document.getElementById('prev-post-btn-container');
            const nextContainer = document.getElementById('next-post-btn-container');
            
            prevContainer.innerHTML = '';
            nextContainer.innerHTML = '';

            if (currentIdx > 0) {
                const prevPost = postListCache[currentIdx - 1];
                const btn = document.createElement('button');
                btn.className = 'text-sm text-gray-400 hover:text-white flex items-center gap-1 transition-colors';
                btn.innerHTML = `<i data-lucide="chevron-left" class="w-4 h-4"></i> Prev`;
                btn.onclick = () => {
                    history.pushState({ id: prevPost.id }, '', `?id=${prevPost.id}`);
                    fetchPostDetail(prevPost.id);
                };
                prevContainer.appendChild(btn);
            }

            if (currentIdx !== -1 && currentIdx < postListCache.length - 1) {
                const nextPost = postListCache[currentIdx + 1];
                const btn = document.createElement('button');
                btn.className = 'text-sm text-gray-400 hover:text-white flex items-center gap-1 transition-colors';
                btn.innerHTML = `Next <i data-lucide="chevron-right" class="w-4 h-4"></i>`;
                btn.onclick = () => {
                    history.pushState({ id: nextPost.id }, '', `?id=${nextPost.id}`);
                    fetchPostDetail(nextPost.id);
                };
                nextContainer.appendChild(btn);
            }

            // ëŒ“ê¸€ ë¡œë“œ
            loadComments(post.id);
            lucide.createIcons();
        };

        // --- ëŒ“ê¸€ ì‹œìŠ¤í…œ (ê¸°ì¡´ ë¡œì§ ìœ ì§€ + UI ê°œì„ ) ---
        window.loadComments = async (postId) => {
            const list = document.getElementById('comments-list');
            list.innerHTML = '<div class="spinner mx-auto"></div>'; // ë¡œë”©
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/blog/posts/${postId}/comments`);
                const comments = response.ok ? await response.json() : [];
                
                if (comments.length === 0) {
                    list.innerHTML = '<p class="text-center text-gray-500 text-sm py-4">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
                    return;
                }

                list.innerHTML = comments.map(c => {
                    const date = new Date(c.date).toLocaleDateString('ko-KR', {
                        month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
                    });
                    
                    return `
                        <div class="bg-black/30 p-4 rounded-xl border border-white/5 group">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-bold text-indigo-300 text-sm">${c.author}</span>
                                <div class="flex items-center gap-3 text-xs text-gray-500">
                                    <span>${date}</span>
                                    <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button onclick="editComment(${c.id}, '${c.content.replace(/'/g, "\\'")}')" class="hover:text-white">ìˆ˜ì •</button>
                                        <button onclick="deleteComment(${c.id})" class="hover:text-red-400">ì‚­ì œ</button>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-300 text-sm whitespace-pre-wrap leading-relaxed">${c.content}</p>
                        </div>
                    `;
                }).join('');
                
            } catch (e) {
                list.innerHTML = '<p class="text-red-400 text-sm">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        };

        // ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ë¡œì§ (window ê°ì²´ì— í• ë‹¹í•˜ì—¬ HTML onclickì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•¨)
        window.editComment = async (commentId, currentContent) => {
            const newContent = prompt('ëŒ“ê¸€ ìˆ˜ì •:', currentContent);
            if (!newContent || newContent === currentContent) return;
            const password = prompt('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥:');
            if (!password) return;

            try {
                const res = await fetch(`${API_BASE_URL}/api/blog/posts/${currentPostId}/comments/${commentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: newContent, password })
                });
                if(res.ok) { loadComments(currentPostId); alert('ìˆ˜ì • ì™„ë£Œ'); }
                else { const err = await res.json(); alert(`ì˜¤ë¥˜: ${err.error}`); }
            } catch(e) { alert('í†µì‹  ì˜¤ë¥˜'); }
        };

        window.deleteComment = async (commentId) => {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const password = prompt('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥:');
            if (!password) return;

            try {
                const res = await fetch(`${API_BASE_URL}/api/blog/posts/${currentPostId}/comments/${commentId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                if(res.ok) { loadComments(currentPostId); alert('ì‚­ì œ ì™„ë£Œ'); }
                else { const err = await res.json(); alert(`ì˜¤ë¥˜: ${err.error}`); }
            } catch(e) { alert('í†µì‹  ì˜¤ë¥˜'); }
        };

        document.getElementById('comment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const author = document.getElementById('comment-author').value;
            const password = document.getElementById('comment-password').value;
            const content = document.getElementById('comment-content').value;

            try {
                const res = await fetch(`${API_BASE_URL}/api/blog/posts/${currentPostId}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ author, password, content })
                });
                
                if (res.ok) {
                    document.getElementById('comment-content').value = '';
                    loadComments(currentPostId);
                } else {
                    const err = await res.json();
                    alert(`ì‹¤íŒ¨: ${err.error}`);
                }
            } catch(e) { alert('í†µì‹  ì˜¤ë¥˜'); }
        });

        // --- ì´ˆê¸°í™” ë° ë©”ì¸ ë¡œì§ ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Dock ì´ë²¤íŠ¸ ì—°ê²°
            dock.list.addEventListener('click', (e) => {
                e.preventDefault();
                history.pushState(null, '', 'blog.html');
                switchView('list');
            });
            dock.back.addEventListener('click', (e) => {
                e.preventDefault();
                history.back();
            });

            // ë°ì´í„° ë¡œë“œ
            views.loading.classList.remove('hidden');
            try {
                const res = await fetch(`${API_BASE_URL}/api/blog/posts`);
                if (!res.ok) throw new Error();
                postListCache = await res.json();

                // ë¡œì»¬ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì£¼ì… ë¡œì§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
                const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
                if (isLocal) {
                    postListCache.unshift({
                        id: 'local-test-post',
                        title: 'ğŸš€ ë¡œì»¬ í™˜ê²½ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼',
                        author: 'Dev Admin',
                        date: new Date().toISOString().split('T')[0],
                        views: 999,
                        content: `<p>ë¡œì»¬ í™˜ê²½ì—ì„œë§Œ ë³´ì´ëŠ” í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì…ë‹ˆë‹¤. <strong>Bento Grid</strong> ë ˆì´ì•„ì›ƒê³¼ <strong>Glassmorphism</strong> UIë¥¼ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤.</p>
                                  <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=2070&auto=format&fit=crop" alt="Test">
                                  <ul><li>Spotlight Effect í™•ì¸</li><li>Floating Dock ë™ì‘ í™•ì¸</li><li>Responsiveness í™•ì¸</li></ul>`
                    });
                }
            } catch (e) {
                console.error("Load Failed");
                // API ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì´ë©´ ë”ë¯¸ë¼ë„ ë³´ì—¬ì¤Œ
                const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
                if (isLocal && postListCache.length === 0) {
                     postListCache.unshift({
                        id: 'local-test-post',
                        title: 'âš ï¸ API Connection Failed (Test Mode)',
                        author: 'System',
                        date: new Date().toISOString().split('T')[0],
                        content: '<p>API ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.</p>'
                    });
                }
            } finally {
                views.loading.classList.add('hidden');
            }

            // ì´ˆê¸° ë·° ë Œë”ë§
            renderBlogGrid(postListCache);

            // URL ì¿¼ë¦¬ì— ë”°ë¥¸ ë¼ìš°íŒ…
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');
            if (postId) {
                fetchPostDetail(postId);
            } else {
                switchView('list');
            }

            // ë’¤ë¡œê°€ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬
            window.addEventListener('popstate', () => {
                const urlParams = new URLSearchParams(window.location.search);
                const postId = urlParams.get('id');
                if (postId) {
                    fetchPostDetail(postId);
                } else {
                    switchView('list');
                }
            });
        });
    </script>
</body>
</html>