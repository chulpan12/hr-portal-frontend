<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamofEnC - Blog</title>
    <link rel="stylesheet" href="../../assets/blog.css?v=2.3835">
</head>
<body>
    <div class="container">
        <h1 class="page-title">AI/ìë™í™” í™œìš©ì‹¤ì </h1>

        <main class="content-area">
            <div id="post-list-view"></div>
            <div id="post-detail-view" style="display: none;"></div>
        </main>
        
        <div id="fab-list-container" class="fab-container">
            <a href="../../index.html" class="fab" title="í™ˆìœ¼ë¡œ">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>
            </a>
            <a href="editor_login.html" class="fab" title="ìƒˆ ê¸€ ì‘ì„±">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            </a>
        </div>

        <div id="fab-detail-container" class="fab-container" style="display: none;">
            <a href="#" id="fab-history-back" class="fab fab-action" title="ë’¤ë¡œê°€ê¸°">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </a>
            <a href="#" id="fab-back-to-list" class="fab fab-action" title="ëª©ë¡ìœ¼ë¡œ">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7zm-4 6h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            </a>
            <a href="#" id="fab-edit-post" class="fab fab-edit" title="ìˆ˜ì •í•˜ê¸°">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14.06 9.02l.92.92L5.92 19H5v-.92l9.06-9.06M17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29zm-3.6 3.19L3 17.25V21h3.75L17.81 9.94l-3.75-3.75z"/></svg>
            </a>
        </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const postListView = document.getElementById('post-list-view');
    const postDetailView = document.getElementById('post-detail-view');
    
    // FAB ì»¨í…Œì´ë„ˆ ë° ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì •)
    const fabListContainer = document.getElementById('fab-list-container');
    const fabDetailContainer = document.getElementById('fab-detail-container');
    const fabHistoryBack = document.getElementById('fab-history-back');
    const fabBackToList = document.getElementById('fab-back-to-list');
    const fabEditPost = document.getElementById('fab-edit-post');
    
    // API ë° ìºì‹œ ë³€ìˆ˜
    const API_BASE_URL = 'https://api.dreamofenc.com'; 
    let postListCache = [];

    // --- START: ì‡¼ì¼€ì´ìŠ¤(ëª©ë¡) ê´€ë ¨ ë¡œì§ ---
    let currentIndex = 0;

    const displayShowcaseList = (posts) => {
        postListView.style.display = 'flex';
        postDetailView.style.display = 'none';
        
        // FAB ì»¨í…Œì´ë„ˆ ê°€ì‹œì„± ì œì–´ (ìˆ˜ì •)
        fabListContainer.style.display = 'flex';
        fabDetailContainer.style.display = 'none';
        
        // ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ì œì–´ (ì‡¼ì¼€ì´ìŠ¤ ëª¨ë“œ)
        document.querySelector('.container').classList.remove('detail-view');

        postListView.innerHTML = `
            <div id="showcase-container" class="showcase-container">
                <div id="showcase-wrapper" class="showcase-wrapper"></div>
                <button id="nav-prev" class="showcase-nav prev">&lt;</button>
                <button id="nav-next" class="showcase-nav next">&gt;</button>
            </div>
        `;
        
        const showcaseWrapper = document.getElementById('showcase-wrapper');
        if (!posts || posts.length === 0) {
            showcaseWrapper.innerHTML = '<p class="no-posts">ì•„ì§ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        posts.forEach((post, index) => {
            const card = document.createElement('div');
            card.className = 'showcase-card';
            card.dataset.index = index;

            const imgMatch = post.content.match(/<img[^>]+src="([^">]+)"/);
            const imageHtml = imgMatch ? `<img src="${imgMatch[1]}" alt="${post.title} ì´ë¯¸ì§€" class="card-image">` : '<div class="card-image-placeholder"></div>';

            card.innerHTML = `
                ${imageHtml}
                <div class="card-content">
                    <h2 class="card-title">${post.title}</h2>
                    <p class="card-meta">${post.date} by ${post.author} | ğŸ‘ï¸ ${post.views || 0}</p>
                    <p class="card-preview">${createTextPreview(post.content, 320)}</p>
                </div>
            `;
            
            card.addEventListener('click', () => {
                if (!card.classList.contains('active')) return;
                history.pushState({ id: post.id }, '', `?id=${post.id}`);
                fetchPostDetail(post.id);
            });

            showcaseWrapper.appendChild(card);
        });
        
        const renderShowcase = () => {
            const cards = showcaseWrapper.children;
            if (!cards.length) return;
            for (let i = 0; i < cards.length; i++) {
                cards[i].classList.remove('active', 'prev', 'next', 'hidden');
                if (i === currentIndex) {
                    cards[i].classList.add('active');
                } else if (i === (currentIndex - 1 + cards.length) % cards.length) {
                    cards[i].classList.add('prev');
                } else if (i === (currentIndex + 1) % cards.length) {
                    cards[i].classList.add('next');
                } else {
                    cards[i].classList.add('hidden');
                }
            }
        };
        
        document.getElementById('nav-prev').addEventListener('click', () => { 
            currentIndex = (currentIndex - 1 + posts.length) % posts.length; 
            renderShowcase(); 
        });
        document.getElementById('nav-next').addEventListener('click', () => { 
            currentIndex = (currentIndex + 1) % posts.length;
            renderShowcase(); 
        });
        
        renderShowcase();
    };
    // --- END: ì‡¼ì¼€ì´ìŠ¤(ëª©ë¡) ê´€ë ¨ ë¡œì§ ---

    // --- START: ìƒì„¸/ëŒ“ê¸€ ë¡œì§ ---
    const fetchPostDetail = async (id) => {
        if (id === 'local-test-post') {
            const testPost = {
                id: 'local-test-post',
                title: 'ğŸš€ ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œë¬¼',
                author: 'Live Server',
                date: new Date().toISOString().split('T')[0],
                views: 777,
                content: `<img src="https://via.placeholder.com/800x400.png/333/eee?text=Test+Image" alt="í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€" style="width:100%; border-radius: 8px;"><p>ì´ ê²Œì‹œë¬¼ì€ <strong>localhost</strong> ë˜ëŠ” <strong>127.0.0.1</strong>ì—ì„œ ì ‘ì†í–ˆì„ ë•Œë§Œ ë‚˜íƒ€ë‚˜ëŠ” í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ì…ë‹ˆë‹¤.</p><ul><li>ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ í™•ì¸</li><li>ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸</li><li>ìƒì„¸ í˜ì´ì§€ ë¼ìš°íŒ… ì ê²€</li></ul>`
            };
            displayPostDetail(testPost);
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE_URL}/api/blog/posts/${id}`);
            if (!response.ok) throw new Error('Post not found');
            const post = await response.json();
            displayPostDetail(post);
        } catch (error) {
            postDetailView.innerHTML = `<p>ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>`;
        }
    };

    const displayPostDetail = (post) => {
        postListView.style.display = 'none';
        postDetailView.style.display = 'block';
        
        // FAB ì»¨í…Œì´ë„ˆ ê°€ì‹œì„± ì œì–´ (ìˆ˜ì •)
        fabListContainer.style.display = 'none';
        fabDetailContainer.style.display = 'flex';
        fabEditPost.href = `editor_login.html?id=${post.id}`; // ìˆ˜ì • ë²„íŠ¼ ë§í¬ ë™ì  í• ë‹¹
        
        // ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ì œì–´ (ìƒì„¸ ë³´ê¸° ëª¨ë“œ)
        document.querySelector('.container').classList.add('detail-view');

        const currentPostIndex = postListCache.findIndex(p => p.id === post.id);
        const prevPost = currentPostIndex > 0 ? postListCache[currentPostIndex - 1] : null;
        const nextPost = currentPostIndex < postListCache.length - 1 ? postListCache[currentPostIndex + 1] : null;

        const prevButton = prevPost ? `<a href="?id=${prevPost.id}" class="nav-button prev-button" data-nav-id="${prevPost.id}">&lt; ì´ì „ ê¸€</a>` : `<span class="nav-button disabled">&lt; ì´ì „ ê¸€</span>`;
        const nextButton = nextPost ? `<a href="?id=${nextPost.id}" class="nav-button next-button" data-nav-id="${nextPost.id}">ë‹¤ìŒ ê¸€ &gt;</a>` : `<span class="nav-button disabled">ë‹¤ìŒ ê¸€ &gt;</span>`;

        // ìƒì„¸ ë³´ê¸° HTMLì—ì„œ ìˆ˜ì • ë²„íŠ¼ ì‚­ì œ (ìˆ˜ì •)
        postDetailView.innerHTML = `
            <div class="post-navigation">${prevButton}${nextButton}</div>
            <h2 class="post-title">${post.title}</h2>
            <p class="post-meta">${post.date} by ${post.author}<span style="float: right; opacity: 0.7;">ğŸ‘ï¸ ${post.views || 0}</span></p>
            <div class="post-content">${post.content}</div>
            <hr style="margin: 40px 0 30px; border-color: #333;">
            <div id="comments-section">
                </div>`;
        
        postDetailView.querySelectorAll('.nav-button[data-nav-id]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const navId = e.target.dataset.navId;
                history.pushState({ id: navId }, '', `?id=${navId}`);
                fetchPostDetail(navId);
            });
        });
    };
    const createTextPreview = (htmlString, maxLength) => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlString;
        const text = tempDiv.textContent || tempDiv.innerText || "";
        return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    };
    // --- END: ìƒì„¸/ëŒ“ê¸€ ë¡œì§ ---
    
    // --- START: ë©”ì¸ ë¡œì§ ---
    const renderContent = async () => {
        try {
            const response = await fetch(`${API_BASE_URL}/api/blog/posts`);
            if (!response.ok) throw new Error('Network response was not ok');
            postListCache = await response.json();
            
            // â–¼â–¼â–¼ ë¡œì»¬ í™˜ê²½ì¼ ë•Œ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì„ ì¶”ê°€í•˜ëŠ” ë¡œì§ â–¼â–¼â–¼
            const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
            if (isLocal) {
                const testPost = {
                    id: 'local-test-post',
                    title: 'ğŸš€ ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œë¬¼',
                    author: 'Live Server',
                    date: new Date().toISOString().split('T')[0],
                    views: 777,
                    content: `
                        <img src="https://via.placeholder.com/600x400.png/333/eee?text=Test+Image" alt="í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€">
                        <p>ì´ ê²Œì‹œë¬¼ì€ <strong>localhost</strong> ë˜ëŠ” <strong>127.0.0.1</strong>ì—ì„œë§Œ ë³´ì…ë‹ˆë‹¤.</p>
                    `
                };
                postListCache.unshift(testPost); // ë°°ì—´ì˜ ê°€ì¥ ì•ì— í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ ì¶”ê°€
            }
            // â–²â–²â–² ë¡œì»¬ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ ë¡œì§ ë â–²â–²â–²

        } catch (error) {
            console.error("ê²Œì‹œë¬¼ ë¡œë”© ì‹¤íŒ¨:", error);
            postListView.innerHTML = '<p>ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
            
            // â–¼â–¼â–¼ API ë¡œë”© ì‹¤íŒ¨ ì‹œì—ë„ ë¡œì»¬ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ì€ ë³´ì´ë„ë¡ ì²˜ë¦¬ â–¼â–¼â–¼
            const isLocal = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
            if (isLocal && postListCache.length === 0) {
                    const testPost = {
                    id: 'local-test-post',
                    title: 'ğŸš€ ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œë¬¼ (API ì‹¤íŒ¨)',
                    author: 'Live Server',
                    date: new Date().toISOString().split('T')[0],
                    views: 777,
                    content: `
                        <img src="https://via.placeholder.com/600x400.png/333/eee?text=Test+Image" alt="í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€">
                        <p>API ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆì§€ë§Œ, ë¡œì»¬ í™˜ê²½ì´ë¯€ë¡œ í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œë¬¼ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                    `
                };
                postListCache.unshift(testPost);
            }
            // â–²â–²â–² ë¡œì»¬ í…ŒìŠ¤íŠ¸ ê²Œì‹œë¬¼ ë¡œì§ ë â–²â–²â–²
        }

        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');

        if (postId) {
            fetchPostDetail(postId);
        } else {
            displayShowcaseList(postListCache);
        }
    };

    // ìƒì„¸ ë³´ê¸°ìš© FAB ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ìˆ˜ì •)
    fabBackToList.addEventListener('click', (e) => {
        e.preventDefault();
        history.pushState(null, '', 'blog.html');
        displayShowcaseList(postListCache);
    });

    fabHistoryBack.addEventListener('click', (e) => {
        e.preventDefault();
        history.back();
    });
    
    window.addEventListener('popstate', (event) => {
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');
        if (postId) {
            fetchPostDetail(postId);
        } else {
            displayShowcaseList(postListCache);
        }
    });

    renderContent();
});
</script>
</body>
</html>